# üöÄ –°–µ—Ä–≤–∏—Å –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –∑–≤–æ–Ω–∫–∞

MVP —Å–µ—Ä–≤–∏—Å –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ñ–æ—Ä–º—ã –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –∑–≤–æ–Ω–∫–∞ –Ω–∞ –ª—é–±–æ–π —Å–∞–π—Ç —Å –ø–æ–º–æ—â—å—é –æ–¥–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞.

## üìã –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ –ü–ª–∞–≤–∞—é—â–∞—è –∫–Ω–æ–ø–∫–∞ –≤ –ø—Ä–∞–≤–æ–º –Ω–∏–∂–Ω–µ–º —É–≥–ª—É
- ‚úÖ –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å —Ñ–æ—Ä–º–æ–π
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π (–∏–º—è, —Ç–µ–ª–µ—Ñ–æ–Ω)
- ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ Webhook
- ‚úÖ Rate limiting –∏ –∑–∞—â–∏—Ç–∞ –æ—Ç —Ñ–ª—É–¥–∞
- ‚úÖ –ö—Ä–∞—Å–∏–≤—ã–π —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π UI
- ‚úÖ –ü—Ä–æ—Å—Ç–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –æ–¥–Ω–∏–º —Å–∫—Ä–∏–ø—Ç–æ–º
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ fbclid –¥–ª—è Facebook —Ä–µ–∫–ª–∞–º—ã
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–≤—É—Ö—ç—Ç–∞–ø–Ω—ã—Ö —Ñ–æ—Ä–º
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å amoCRM —á–µ—Ä–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
npm install
```

### 2. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

```bash
npm start
```

–°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∞ –ø–æ—Ä—Ç—É 3000 (–∏–ª–∏ PORT –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è).

### 3. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ —Å–∞–π—Ç

–î–æ–±–∞–≤—å—Ç–µ –Ω–∞ –ª—é–±—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É:

```html
<script src="http://yourdomain.com:3000/popup.js" async></script>
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
callback-form-service/
‚îú‚îÄ‚îÄ server.js          # –û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–µ—Ä
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îî‚îÄ‚îÄ popups.js     # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ–ø–∞–ø–æ–≤
‚îú‚îÄ‚îÄ public/
‚îÇ   ‚îî‚îÄ‚îÄ popup.js      # –°–∫—Ä–∏–ø—Ç –¥–ª—è –≤—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ package.json
‚îî‚îÄ‚îÄ README.md
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–ø–∞–ø–æ–≤

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `data/popups.js`:

```javascript
module.exports = {
  'call-me-button': {
    label: '–ñ–¥—É –∑–≤–æ–Ω–∫–∞',
    fields: ['name', 'phone'],
    position: 'bottom-right',
    color: '#007bff',
    webhook: '/api/webhook',
  },
  // –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–µ –ø–æ–ø–∞–ø—ã –∑–¥–µ—Å—å
};
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

- `PORT` - –ø–æ—Ä—Ç —Å–µ—Ä–≤–µ—Ä–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 3000)
- `ROISTAT_WEBHOOK_URL` ‚Äî URL –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ webhook (–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω)

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ `.env.example` –∏ —É–∫–∞–∂–∏—Ç–µ –≤–∞—à URL.

## üîß API

### POST /api/webhook

–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –≤ Roistat.

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "popupId": "call-me-button",
  "name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
  "phone": "+79876543210",
  "fbclid": "IwAR123456789"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "message": "–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!"
}
```

### GET /health

–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞.

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- Rate limiting: 100 –∑–∞–ø—Ä–æ—Å–æ–≤ —Å IP –∑–∞ 15 –º–∏–Ω—É—Ç
- –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
- –ó–∞—â–∏—Ç–∞ –æ—Ç XSS —á–µ—Ä–µ–∑ helmet
- CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- –¢–∞–π–º–∞—É—Ç –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (10 —Å–µ–∫)

## üé® –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∏–ª–µ–π

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ CSS –≤ `public/popup.js`:

```javascript
const styles = `
  .callback-button {
    background: #your-color;
    // –≤–∞—à–∏ —Å—Ç–∏–ª–∏
  }
`;
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–æ–ø–∞–ø–æ–≤

1. –î–æ–±–∞–≤—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ `data/popups.js`
2. –ò–∑–º–µ–Ω–∏—Ç–µ `popupId` –≤ `public/popup.js`

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏

–°–µ—Ä–≤–µ—Ä –ª–æ–≥–∏—Ä—É–µ—Ç:
- –£—Å–ø–µ—à–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ webhook
- –û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- –û—à–∏–±–∫–∏ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

### Health check

```bash
curl http://localhost:3000/health
```

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### PM2 (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
npm install -g pm2
pm2 start server.js --name callback-service
pm2 save
pm2 startup
```

### Docker

```dockerfile
FROM node:18-alpine
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
EXPOSE 3000
CMD ["npm", "start"]
```

## üîÑ –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å

–°–µ—Ä–≤–∏—Å –≥–æ—Ç–æ–≤ –∫ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é:

- ‚úÖ –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–ø–∞–ø—ã
- ‚úÖ –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ webhook –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ø–∞–ø–∞
- ‚úÖ UI-—Ä–µ–¥–∞–∫—Ç–æ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞—è–≤–æ–∫
- ‚úÖ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

## üìä –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –∫–∞–º–ø–∞–Ω–∏–π

### Facebook —Ä–µ–∫–ª–∞–º–∞ (fbclid)

–°–µ—Ä–≤–∏—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä `fbclid` –∏–∑ URL –∏ –ø–µ—Ä–µ–¥–∞–µ—Ç –µ–≥–æ –≤ amoCRM:

```javascript
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –∏–∑ URL:
// https://example.com/?fbclid=IwAR123456789
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ amoCRM

1. –°–æ–∑–¥–∞–π—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ —Ç–∏–ø–∞ "–¢–µ–∫—Å—Ç"
2. –ù–∞–∑–≤–∞–Ω–∏–µ: `fbclid`
3. –ö–æ–¥ –ø–æ–ª—è: `fbclid`

### –ü—Ä–∏–º–µ—Ä—ã URL —Å fbclid

```
https://your-site.com/?fbclid=IwAR123456789
https://your-site.com/page#fbclid=IwAR123456789
```

–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: [FBCLID_INTEGRATION.md](./FBCLID_INTEGRATION.md)

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
2. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –≤–Ω–µ—à–Ω–µ–≥–æ webhook
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
4. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—ã

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT 

## üì¶ –î–µ–ø–ª–æ–π –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ popup.js

1. **–†–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ** —Ñ–∞–π–ª `callback-form-service/public/popup.js` –≤ –ø—Ä–æ–µ–∫—Ç–µ.
2. **–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π** —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –µ–≥–æ –≤ –ø–∞–ø–∫—É, –∫–æ—Ç–æ—Ä—É—é —Ä–∞–∑–¥–∞—ë—Ç –≤–∞—à –≤–µ–±-—Å–µ—Ä–≤–µ—Ä –¥–ª—è popup.progkids.com:
   ```bash
   cp /root/callback-form-service/public/popup.js /var/www/popup.progkids.com/public/popup.js
   ```
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ**, —á—Ç–æ –ø–æ –∞–¥—Ä–µ—Å—É  
   `https://popup.progkids.com/popup.js`  
   –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∞–∫—Ç—É–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è —Ñ–∞–π–ª–∞.

--- 